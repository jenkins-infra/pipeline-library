name: Update Technical Requirements in CONTRIBUTING.md

sources:
  getMavenLabel:
    kind: file
    name: Get Maven label from Jenkinsfile
    spec:
      file: Jenkinsfile
      marker: 'label '''
      pattern: '(maven-[0-9]+)'

  getPackerImageVersion:
    kind: yaml
    name: Get Packer image version from jenkins-infra
    spec:
      file: hieradata/common.yaml
      key: $.profile::jenkinscontroller::jcasc.agent_images.azure_vms_gallery_image.version

  getToolVersions:
    kind: yaml
    name: Get tool versions from packer-images
    dependson:
      - getPackerImageVersion
    spec:
      file: https://raw.githubusercontent.com/jenkins-infra/packer-images/{{ source "getPackerImageVersion" }}/provisioning/tools-versions.yml

targets:
  updateTechnicalRequirements:
    name: Update Technical Requirements section in CONTRIBUTING.md
    kind: file
    spec:
      file: CONTRIBUTING.md
      transformers:
        - replaceRegex:
            pattern: '### Technical Requirements[\s\S]*?(?=### Add a)'
            with: |
              ### Technical Requirements

              <!-- This section is automatically generated by updatecli with the manifest ./updatecli/weekly.d/contributing.yaml -->

              In order to work with that repository you will need:

              - JDK {{ source "getToolVersions" "jdk.version" }}: Check [Temurin releases](https://adoptium.net/temurin/releases/v{{ source "getToolVersions" "jdk.version" }})

    scmid: default

actions:
  default:
    kind: github/pullrequest
    scmid: default
    title: "chore(deps): update technical requirements in CONTRIBUTING.md"
    spec:
      labels:
        - dependencies
        - documentation
